Yanal yayılımı tespit etmek için tuzak sistemler kullanacağız. Ancak biraz farklı bir yaklaşımla. Normalde bu sorun için honeypotlar kullanılıyor. Ancak tespit edilmesi çok kolay ve saldırı vektörünü çıkartmak mümkün olmuyor. Biz ise gerçek tuzak sistemler kullanacağız. Bunlar dmz'de rastgele yerlerde bulunan, sürekli, her aktivitesi dinlenen, gerçek sistemleri taklit eden ama aslında hiçbir işlevi olmayan düşük yetkili endpointler olacak. Bu endpointlerde bilinci olarak güvenlik açıklıkları bırakılacak ve izlenecek. Eğer bu güvenlik açıklıkları sömürülüyor ise yanal bir sıçrama olduğu alert'i yönetim sistemlerine loglari ile birlikte iletilecek ve soc ekipleri gerekli aksiyonlari alacak. Peki bu tuzak sistemlerin bizim dmz'imizde fiziksel olarak bulunmasına gerek var mi. Tabi ki yok. Aslında bunlar sadece layer 2 vpn tünelleri. Tıpkı uzun bir ethernet kablosu ile dmz networküne çeşitli noktalara bağlanmış makineler gibi. Network topolojisi linkteki gorselde:https://raw.githubusercontent.com/ffucucuoglu/ttfikirmaratonu/main/t.png . Şimdi tuzak sistemlerin iç yapısından bahsedelim. Temelde windows veya linux bir makinenin canlı olarak incelenmesi ile oluşuyor. Makine sanal bir ortamda çalışmalı ki temiz snapshot'ına dönmemiz kolay olsun. Type 1 veya type 2 hypervisor kullanılabilir. Type 1 daha başarılı olacaktır çünkü malwarelerin sanal ortamda çalıştığını tespit etmesi çok daha zorlaşır. Ayrıca hypervisor üzerinden agentless analiz mümkün. Ancak kendince zorlukları var ve uzun bir ar-ge süreci gerektiriyor. Her exploit için kendi kurallarınızı yazmanız gerekebilir. Başka bir yöntem ise sysmon loglarını analiz etmek. Bunun için open source olarak Elasticsearch gibi ürünler mevcut ve otomatize hale getirmek çok kolay. Sigma kuralları sysmon loglarındaki anomalileri tespit eder. Halihazırda sektörde bulunan bir çok ürün de bunu yapıyor ve güçlü bir community oluşmuş durumda. Yeni bir exploit çıktığında sigma kuralının yazılması ve dağıtılması çok kısa zaman içinde oluyor. Ayrıca saldırganın ne gibi aktivitelerde bulunduğu da loglardan anlaşılabiliyor. Böylece saldırgan bir 0-day exploiti ile sisteme girmiş olsa dahi tespit edilecek ve saldırı vektörü çıkartılabilecektir. Sonuçta bir malware saklanabilir ama çalıştırılmak zorundadır.
Elasticsearch, sysmon ve hazır sigma kuralları ile yaptığım prototip diğer denemelerime göre en başarılısı oldu. Daha birçok özellik eklenebilir ve kritik bir ihtiyacı karşıladığını düşünüyorum. Sadece soc ekiplerinin işlerini kolaylaştırmakla kalmıyor, worst-case scenario için güzel bir çözüm oluyor.